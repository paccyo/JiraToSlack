<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>main() å‡¦ç†ãƒ•ãƒ­ãƒ¼å›³ - JiraToSlack Dashboard Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Yu Gothic', Meiryo, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        
        .flow-section {
            margin-bottom: 40px;
        }
        
        .phase-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .phase-number {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 20px;
            margin-right: 10px;
            font-size: 0.9em;
        }
        
        .step {
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .step:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .step-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }
        
        .step-icon {
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 0.9em;
        }
        
        .function-call {
            background: white;
            border: 2px solid #e8eaf6;
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }
        
        .func-name {
            color: #5e35b1;
            font-weight: bold;
        }
        
        .input {
            color: #00695c;
            margin-left: 20px;
        }
        
        .output {
            color: #d84315;
            margin-left: 20px;
        }
        
        .arrow {
            text-align: center;
            color: #667eea;
            font-size: 1.5em;
            margin: 10px 0;
        }
        
        .parallel-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .parallel-item {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #2196f3;
        }
        
        .note {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
        }
        
        .note-title {
            font-weight: bold;
            color: #e65100;
            margin-bottom: 8px;
        }
        
        .data-flow {
            background: #e8f5e9;
            border: 2px dashed #4caf50;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .data-label {
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 8px;
        }
        
        .legend {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-top: 40px;
        }
        
        .legend-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .legend-item {
            display: inline-block;
            margin: 5px 15px 5px 0;
        }
        
        .legend-box {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
            vertical-align: middle;
            border-radius: 3px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ main() å‡¦ç†ãƒ•ãƒ­ãƒ¼å›³</h1>
        <p class="subtitle">prototype/local_cli/main.py - ã‚¹ãƒ—ãƒªãƒ³ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”Ÿæˆãƒ•ãƒ­ãƒ¼</p>
        
        <div class="summary-stats">
            <div class="stat-card">
                <div class="stat-number">7</div>
                <div class="stat-label">ä¸»è¦ãƒ•ã‚§ãƒ¼ã‚º</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">15+</div>
                <div class="stat-label">å¤–éƒ¨ã‚¯ã‚¨ãƒªå®Ÿè¡Œ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">3</div>
                <div class="stat-label">å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">AI</div>
                <div class="stat-label">Geminiçµ±åˆ</div>
            </div>
        </div>

        <!-- Phase 1: ç’°å¢ƒæº–å‚™ -->
        <div class="flow-section">
            <div class="phase-header">
                <span class="phase-number">Phase 1</span>
                ç’°å¢ƒã¨èªè¨¼ã®æº–å‚™
            </div>
            
            <div class="step">
                <div class="step-title">
                    <span class="step-icon">1</span>
                    ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿
                </div>
                <div class="function-call">
                    <span class="func-name">ensure_env_loaded()</span>
                    <div class="input">ğŸ“¥ å…¥åŠ›: ãªã—ï¼ˆ.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¤‡æ•°ãƒ‘ã‚¹ã‹ã‚‰æ¢ç´¢ï¼‰</div>
                    <div class="output">ğŸ“¤ å‡ºåŠ›: boolï¼ˆèª­ã¿è¾¼ã¿æˆåŠŸ/å¤±æ•—ï¼‰</div>
                </div>
                <div class="note">
                    <div class="note-title">ğŸ’¡ å‡¦ç†å†…å®¹</div>
                    å€™è£œãƒ‘ã‚¹ï¼ˆlocal_cli/.env, queries/.env, cwd/.env, repo_root/.envï¼‰ã‹ã‚‰.envã‚’èª­ã¿è¾¼ã¿ã€os.environã«åæ˜ ã€‚
                </div>
            </div>

            <div class="arrow">â¬‡ï¸</div>

            <div class="step">
                <div class="step-title">
                    <span class="step-icon">2</span>
                    Jiraèªè¨¼æƒ…å ±ã®å–å¾—
                </div>
                <div class="data-flow">
                    <div class="data-label">ğŸ”‘ å–å¾—ã™ã‚‹ç’°å¢ƒå¤‰æ•°</div>
                    <ul>
                        <li>JIRA_DOMAINï¼ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰</li>
                        <li>JIRA_EMAILï¼ˆèªè¨¼ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰</li>
                        <li>JIRA_API_TOKENï¼ˆAPIãƒˆãƒ¼ã‚¯ãƒ³ï¼‰</li>
                    </ul>
                </div>
                <div class="function-call">
                    auth = <span class="func-name">HTTPBasicAuth</span>(email, api_token)
                </div>
            </div>
        </div>

        <!-- Phase 2: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾— -->
        <div class="flow-section">
            <div class="phase-header">
                <span class="phase-number">Phase 2</span>
                Jira ãƒœãƒ¼ãƒ‰ãƒ»ã‚¹ãƒ—ãƒªãƒ³ãƒˆ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—
            </div>

            <div class="step">
                <div class="step-title">
                    <span class="step-icon">3</span>
                    ãƒœãƒ¼ãƒ‰è§£æ±º
                </div>
                <div class="function-call">
                    <span class="func-name">resolve_board</span>(JIRA_DOMAIN, auth)
                    <div class="input">ğŸ“¥ å…¥åŠ›: ãƒ‰ãƒ¡ã‚¤ãƒ³, HTTPBasicAuth</div>
                    <div class="output">ğŸ“¤ å‡ºåŠ›: (HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹, boardè¾æ›¸, ã‚¨ãƒ©ãƒ¼æ–‡å­—åˆ—)</div>
                </div>
                <div class="note">
                    <div class="note-title">ğŸ” å†…éƒ¨å‡¦ç†</div>
                    <ul>
                        <li>JIRA_BOARD_IDã¾ãŸã¯JIRA_PROJECT_KEYã‹ã‚‰é©åˆ‡ãªãƒœãƒ¼ãƒ‰ã‚’æ¢ç´¢</li>
                        <li>ã‚¹ãƒ—ãƒªãƒ³ãƒˆå¯¾å¿œãƒœãƒ¼ãƒ‰ã®ã¿ã‚’é¸æŠï¼ˆScrumãƒœãƒ¼ãƒ‰å„ªå…ˆï¼‰</li>
                        <li>board_selector.pyã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨</li>
                    </ul>
                </div>
            </div>

            <div class="arrow">â¬‡ï¸</div>

            <div class="step">
                <div class="step-title">
                    <span class="step-icon">4</span>
                    ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»ã‚¹ãƒ—ãƒªãƒ³ãƒˆæƒ…å ±ã®åé›†
                </div>
                <div class="parallel-group">
                    <div class="parallel-item">
                        <strong>try_infer_project_key_from_board()</strong>
                        <div>â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚­ãƒ¼ã‚’æ¨å®š</div>
                    </div>
                    <div class="parallel-item">
                        <strong>count_boards_for_project()</strong>
                        <div>â†’ ãƒœãƒ¼ãƒ‰ç·æ•°ï¼ˆboards_nï¼‰</div>
                    </div>
                    <div class="parallel-item">
                        <strong>count_active_sprints_for_board()</strong>
                        <div>â†’ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ—ãƒªãƒ³ãƒˆæ•°ï¼ˆsprints_nï¼‰</div>
                    </div>
                    <div class="parallel-item">
                        <strong>resolve_active_sprint()</strong>
                        <div>â†’ ã‚¹ãƒ—ãƒªãƒ³ãƒˆè©³ç´°ï¼ˆname, startDate, endDateï¼‰</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 3: ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿å–å¾— -->
        <div class="flow-section">
            <div class="phase-header">
                <span class="phase-number">Phase 3</span>
                ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆã‚µãƒ–ã‚¿ã‚¹ã‚¯ä¸€è¦§ï¼‰
            </div>

            <div class="step">
                <div class="step-title">
                    <span class="step-icon">5</span>
                    ã‚¹ãƒ—ãƒªãƒ³ãƒˆã‚µãƒ–ã‚¿ã‚¹ã‚¯ã®å–å¾—
                </div>
                <div class="function-call">
                    <span class="func-name">get_json_from_script</span>("queries/jira_list_sprint_subtasks.py")
                    <div class="input">ğŸ“¥ å…¥åŠ›: ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹, envå¤‰æ•°ï¼ˆOUTPUT_JSON=1ï¼‰</div>
                    <div class="output">ğŸ“¤ å‡ºåŠ›: dataè¾æ›¸ï¼ˆparents, totalså«ã‚€ï¼‰</div>
                </div>
                <div class="data-flow">
                    <div class="data-label">ğŸ“Š å–å¾—ãƒ‡ãƒ¼ã‚¿æ§‹é€ </div>
                    <pre style="background: white; padding: 10px; border-radius: 4px; overflow-x: auto;">
{
  "parents": [
    {
      "key": "SCRUM-123",
      "summary": "è¦ªã‚¿ã‚¹ã‚¯",
      "assignee": "æ‹…å½“è€…å",
      "subtasks": [
        {
          "key": "SCRUM-124",
          "summary": "å­ã‚¿ã‚¹ã‚¯",
          "done": true,
          "assignee": "æ‹…å½“è€…å"
        }
      ]
    }
  ],
  "totals": {
    "subtasks": 100,
    "done": 75,
    "notDone": 25
  }
}</pre>
                </div>
                <div class="note">
                    <div class="note-title">âš™ï¸ ã‚µãƒ–ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡Œã®ä»•çµ„ã¿</div>
                    <ul>
                        <li>_run_python_script() çµŒç”±ã§Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ</li>
                        <li>å¯èƒ½ã§ã‚ã‚Œã°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œï¼ˆ-mï¼‰ã€å¤±æ•—æ™‚ã¯ç›´æ¥å®Ÿè¡Œ</li>
                        <li>æ¨™æº–å‡ºåŠ›ã®æœ€çµ‚è¡Œã‹ã‚‰JSONã‚’ãƒ‘ãƒ¼ã‚¹</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Phase 4: è¿½åŠ ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›† -->
        <div class="flow-section">
            <div class="phase-header">
                <span class="phase-number">Phase 4</span>
                è¿½åŠ ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ï¼ˆextrasè¾æ›¸ã«æ ¼ç´ï¼‰
            </div>

            <div class="step">
                <div class="step-title">
                    <span class="step-icon">6</span>
                    ä¸¦åˆ—ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
                </div>
                <div class="note">
                    <div class="note-title">ğŸ“Œ ã™ã¹ã¦ã®ã‚¯ã‚¨ãƒªã¯ try-except ã§ä¿è­·ã•ã‚Œã€å¤±æ•—æ™‚ã‚‚å‡¦ç†ç¶™ç¶š</div>
                </div>
                
                <div class="parallel-group">
                    <div class="parallel-item">
                        <strong>A. Burndown</strong>
                        <div style="margin-top: 8px;">
                            <code>jira_q_burndown.py --unit {BURNDOWN_UNIT}</code>
                        </div>
                        <div style="margin-top: 5px; font-size: 0.9em;">
                            â†’ extras["burndown"]
                        </div>
                    </div>

                    <div class="parallel-item">
                        <strong>B. Velocity</strong>
                        <div style="margin-top: 8px;">
                            <code>jira_q_velocity_history.py --n {N_SPRINTS}</code>
                        </div>
                        <div style="margin-top: 5px; font-size: 0.9em;">
                            â†’ extras["velocity"]
                        </div>
                    </div>

                    <div class="parallel-item">
                        <strong>B2. Project Sprint Count</strong>
                        <div style="margin-top: 8px;">
                            <code>jira_count_project_sprints.py</code>
                        </div>
                        <div style="margin-top: 5px; font-size: 0.9em;">
                            â†’ extras["project_sprint_count"]
                        </div>
                    </div>

                    <div class="parallel-item">
                        <strong>C. Status Distribution</strong>
                        <div style="margin-top: 8px;">
                            <code>jira_q_status_counts.py --scope sprint --mode approx</code>
                        </div>
                        <div style="margin-top: 5px; font-size: 0.9em;">
                            â†’ extras["status_counts"]
                        </div>
                    </div>

                    <div class="parallel-item">
                        <strong>D. Time-in-Status</strong>
                        <div style="margin-top: 8px;">
                            <code>jira_q_time_in_status.py --scope sprint --unit days</code>
                        </div>
                        <div style="margin-top: 5px; font-size: 0.9em;">
                            â†’ extras["time_in_status"]
                        </div>
                    </div>

                    <div class="parallel-item">
                        <strong>E. Assignee Workload</strong>
                        <div style="margin-top: 8px;">
                            <code>jira_q_assignee_workload.py --scope sprint</code>
                        </div>
                        <div style="margin-top: 5px; font-size: 0.9em;">
                            â†’ extras["workload"]
                        </div>
                    </div>
                </div>
            </div>

            <div class="arrow">â¬‡ï¸</div>

            <div class="step">
                <div class="step-title">
                    <span class="step-icon">7</span>
                    KPIã¨ãƒªã‚¹ã‚¯æŒ‡æ¨™ã®è¨ˆç®—
                </div>
                <div class="parallel-group">
                    <div class="parallel-item">
                        <strong>F1. Overdue Count</strong>
                        <div style="margin-top: 8px;">
                            <code>jira_q_overdue_count.py --scope sprint</code>
                        </div>
                        <div style="margin-top: 5px;">
                            â†’ risks["overdue"]
                        </div>
                    </div>

                    <div class="parallel-item">
                        <strong>F2. Due Soon Count</strong>
                        <div style="margin-top: 8px;">
                            <code>jira_q_due_soon_count.py --scope sprint --days 7</code>
                        </div>
                        <div style="margin-top: 5px;">
                            â†’ risks["dueSoon"]
                        </div>
                    </div>

                    <div class="parallel-item">
                        <strong>F3. High Priority Unstarted</strong>
                        <div style="margin-top: 8px;">
                            JQL: priority in (Highest,High) AND status="To Do"
                        </div>
                        <div style="margin-top: 5px;">
                            â†’ risks["highPriorityTodo"]
                        </div>
                    </div>

                    <div class="parallel-item">
                        <strong>F4. Unassigned Count</strong>
                        <div style="margin-top: 8px;">
                            <code>jira_q_unassigned_count.py --scope sprint</code>
                        </div>
                        <div style="margin-top: 5px;">
                            â†’ kpis["unassignedCount"]
                        </div>
                    </div>

                    <div class="parallel-item">
                        <strong>F5. Project Subtask Count</strong>
                        <div style="margin-top: 8px;">
                            <code>jira_count_project_subtasks.py</code>
                        </div>
                        <div style="margin-top: 5px;">
                            â†’ kpis["projectTotal"], kpis["projectOpenTotal"]
                        </div>
                    </div>
                </div>

                <div class="data-flow" style="margin-top: 20px;">
                    <div class="data-label">ğŸ“ˆ çµ±åˆã•ã‚Œã‚‹KPIè¾æ›¸</div>
                    <pre style="background: white; padding: 10px; border-radius: 4px;">
kpis = {
  "projectTotal": ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨å°ã‚¿ã‚¹ã‚¯æ•°,
  "projectOpenTotal": ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæœªå®Œäº†ã‚¿ã‚¹ã‚¯æ•°,
  "sprintTotal": ã‚¹ãƒ—ãƒªãƒ³ãƒˆå…¨å°ã‚¿ã‚¹ã‚¯æ•°,
  "sprintOpen": ã‚¹ãƒ—ãƒªãƒ³ãƒˆæœªå®Œäº†ã‚¿ã‚¹ã‚¯æ•°,
  "sprintDone": ã‚¹ãƒ—ãƒªãƒ³ãƒˆå®Œäº†ã‚¿ã‚¹ã‚¯æ•°,
  "unassignedCount": æ‹…å½“è€…æœªå®šã‚¿ã‚¹ã‚¯æ•°,
  "overdue": æœŸé™è¶…éã‚¿ã‚¹ã‚¯æ•°,
  "dueSoon": æœŸé™æ¥è¿‘ã‚¿ã‚¹ã‚¯æ•°ï¼ˆ7æ—¥ä»¥å†…ï¼‰,
  "highPriorityTodo": é«˜å„ªå…ˆåº¦æœªç€æ‰‹ã‚¿ã‚¹ã‚¯æ•°
}

risks = {
  "overdue": æœŸé™è¶…é,
  "dueSoon": æœŸé™æ¥è¿‘,
  "highPriorityTodo": é«˜å„ªå…ˆåº¦æœªç€æ‰‹
}</pre>
                </div>

                <div class="note">
                    <div class="note-title">ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®å„ªå…ˆé †ä½</div>
                    <ul>
                        <li>sprintTotal/sprintDone: data["totals"]ã‹ã‚‰å–å¾—ï¼ˆã‚µãƒ–ã‚¿ã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ï¼‰</li>
                        <li>projectTotal: å°‚ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆjira_count_project_subtasks.pyï¼‰å„ªå…ˆã€å¤±æ•—æ™‚ã¯JQLã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯</li>
                        <li>risksæŒ‡æ¨™: ã‚µãƒ–ã‚¿ã‚¹ã‚¯é™å®šJQLã§å†è¨ˆç®—ã—ã€æ­£ç¢ºæ€§ã‚’æ‹…ä¿</li>
                    </ul>
                </div>
            </div>

            <div class="arrow">â¬‡ï¸</div>

            <div class="step">
                <div class="step-title">
                    <span class="step-icon">8</span>
                    ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç”Ÿæˆ
                </div>
                <div class="function-call">
                    <span class="func-name">G. Evidence Generation</span>
                    <div class="input">ğŸ“¥ å…¥åŠ›: extras["time_in_status"]ã‹ã‚‰top Nèª²é¡Œã‚’æŠ½å‡º</div>
                    <div class="output">ğŸ“¤ å‡ºåŠ›: extras["evidence"] = [èª²é¡Œè¾æ›¸...]</div>
                </div>
                <div class="note">
                    <div class="note-title">ğŸ“‹ å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—</div>
                    <ol style="margin-left: 20px;">
                        <li>time_in_statusã‹ã‚‰å…¨èª²é¡Œã®æ»åœ¨æ™‚é–“ã‚’åˆè¨ˆ</li>
                        <li>æ—¥æ•°é™é †ã§ã‚½ãƒ¼ãƒˆã€top Nï¼ˆæ—¢å®š5ä»¶ï¼‰ã‚’æŠ½å‡º</li>
                        <li>JQLã§è©²å½“èª²é¡Œã®è©³ç´°ï¼ˆstatus, assignee, priority, duedateï¼‰ã‚’å–å¾—</li>
                        <li>ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ã§"why"ï¼ˆé‡è¦ãªç†ç”±ï¼‰ã‚’åˆ¤å®š
                            <ul style="margin-left: 20px;">
                                <li>æœŸé™è¶…é â†’ "overdue"</li>
                                <li>7æ—¥ä»¥å†…æœŸé™ â†’ "due soon"</li>
                                <li>é«˜å„ªå…ˆåº¦ â†’ "high priority"</li>
                                <li>5æ—¥ä»¥ä¸Šæ»ç•™ â†’ "long stay"</li>
                            </ul>
                        </li>
                        <li>ã‚ªãƒ—ã‚·ãƒ§ãƒ³: Geminiã§"why"ã‚’è‡ªç„¶è¨€èªã§ä¸Šæ›¸ã</li>
                    </ol>
                </div>
                <div class="function-call" style="margin-top: 15px;">
                    <span class="func-name">maybe_gemini_justify_evidences</span>(api_key, evidence_list)
                    <div class="input">ğŸ“¥ å…¥åŠ›: Gemini APIã‚­ãƒ¼, ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹é…åˆ—</div>
                    <div class="output">ğŸ“¤ å‡ºåŠ›: {èª²é¡Œã‚­ãƒ¼: AIç”Ÿæˆç†ç”±æ–‡} è¾æ›¸</div>
                </div>
            </div>
        </div>

        <!-- Phase 5: AIè¦ç´„ç”Ÿæˆ -->
        <div class="flow-section">
            <div class="phase-header">
                <span class="phase-number">Phase 5</span>
                AIè¦ç´„ç”Ÿæˆï¼ˆGeminiçµ±åˆï¼‰
            </div>

            <div class="step">
                <div class="step-title">
                    <span class="step-icon">9</span>
                    ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ§‹ç¯‰ã¨Geminiå‘¼ã³å‡ºã—
                </div>
                <div class="data-flow">
                    <div class="data-label">ğŸ¤– AIè¦ç´„ç”¨ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ</div>
                    <pre style="background: white; padding: 10px; border-radius: 4px; overflow-x: auto;">
context_for_ai = {
  "sprint_label": ã‚¹ãƒ—ãƒªãƒ³ãƒˆåã¨æœŸé–“,
  "sprint_total": å…¨å°ã‚¿ã‚¹ã‚¯æ•°,
  "sprint_done": å®Œäº†å°ã‚¿ã‚¹ã‚¯æ•°,
  "done_percent": å®Œäº†ç‡,
  "target_percent": ç›®æ¨™å®Œäº†ç‡,
  "remaining_days": æ®‹æ—¥æ•°,
  "required_daily_burn": å¿…è¦æ—¥æ¬¡æ¶ˆåŒ–æ•°,
  "actual_daily_burn": å®Ÿç¸¾æ—¥æ¬¡æ¶ˆåŒ–æ•°ï¼ˆç›´è¿‘3æ—¥å¹³å‡ï¼‰,
  "sprint_open": ã‚¹ãƒ—ãƒªãƒ³ãƒˆæœªå®Œäº†æ•°,
  "backlog_open": ãƒãƒƒã‚¯ãƒ­ã‚°æœªå®Œäº†æ•°,
  "velocity_avg": å¹³å‡ãƒ™ãƒ­ã‚·ãƒ†ã‚£,
  "last_velocity": æœ€æ–°ãƒ™ãƒ­ã‚·ãƒ†ã‚£,
  "bottleneck_status": ãƒœãƒˆãƒ«ãƒãƒƒã‚¯å·¥ç¨‹å,
  "bottleneck_days": ãƒœãƒˆãƒ«ãƒãƒƒã‚¯å·¥ç¨‹å¹³å‡æ»åœ¨æ—¥æ•°,
  "review_avg_days": ãƒ¬ãƒ“ãƒ¥ãƒ¼å·¥ç¨‹å¹³å‡æ—¥æ•°,
  "overdue": æœŸé™è¶…éä»¶æ•°,
  "due_soon": æœŸé™æ¥è¿‘ä»¶æ•°,
  "high_priority_unstarted": é«˜å„ªå…ˆåº¦æœªç€æ‰‹ä»¶æ•°,
  "suggested_actions": [ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å€™è£œãƒªã‚¹ãƒˆ],
  "top_evidence": [ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹é…åˆ—],
  "project_open_total": ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“æœªå®Œäº†æ•°
}</pre>
                </div>

                <div class="function-call" style="margin-top: 15px;">
                    <span class="func-name">maybe_gemini_summary</span>(api_key, context_for_ai)
                    <div class="input">ğŸ“¥ å…¥åŠ›: Gemini APIã‚­ãƒ¼ï¼ˆã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆï¼‰, ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¾æ›¸</div>
                    <div class="output">ğŸ“¤ å‡ºåŠ›: AIç”Ÿæˆè¦ç´„ãƒ†ã‚­ã‚¹ãƒˆï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæŒ‡å®šã‚ã‚Šï¼‰</div>
                </div>

                <div class="note">
                    <div class="note-title">âš™ï¸ Geminiè¨­å®š</div>
                    <ul>
                        <li>ãƒ¢ãƒ‡ãƒ«: GEMINI_MODELï¼ˆæ—¢å®š gemini-2.5-flash-liteï¼‰</li>
                        <li>æ¸©åº¦: GEMINI_TEMPERATUREï¼ˆæ—¢å®š 0.1ï¼‰</li>
                        <li>Top-P: GEMINI_TOP_Pï¼ˆæ—¢å®š 0.9ï¼‰</li>
                        <li>æœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³: 640</li>
                        <li>ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: GEMINI_TIMEOUTï¼ˆæ—¢å®š 30ç§’ï¼‰</li>
                        <li>ãƒªãƒˆãƒ©ã‚¤: GEMINI_RETRIESï¼ˆæ—¢å®š 2å›ï¼‰</li>
                        <li>ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆ: RESTï¼ˆgRPCãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å•é¡Œå›é¿ï¼‰</li>
                    </ul>
                </div>

                <div class="note" style="background: #ffe0b2; border-left-color: #f57c00;">
                    <div class="note-title" style="color: #e65100;">ğŸ” APIã‚­ãƒ¼ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚º</div>
                    _sanitize_api_key() ã§ä¸è¦ãªè¨˜å·ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆã‚’é™¤å»ã—ã€'AIza'ä»¥é™ã®æœ‰åŠ¹éƒ¨åˆ†ã®ã¿æŠ½å‡º
                </div>

                <div class="data-flow" style="margin-top: 15px;">
                    <div class="data-label">ğŸ“ å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§æŒ‡å®šï¼‰</div>
                    <pre style="background: white; padding: 10px; border-radius: 4px;">
## ğŸ¯ çµè«–ï¼ˆ1è¡Œæ–­è¨€ï¼‰
å®Œäº†ç‡[X%] - [é †èª¿âœ…/æ³¨æ„âš ï¸/å±é™ºğŸš¨] æ®‹[Y]æ—¥ã§ç›®æ¨™[Z%]ï¼ˆ[ç†ç”±5å­—ä»¥å†…]ï¼‰

## ğŸš¨ å³å®Ÿè¡Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé‡è¦é †3ã¤ï¼‰
1. [æ‹…å½“è€…] â†’ [ã‚¿ã‚¹ã‚¯] ï¼ˆ[æœŸé™]ï¼‰
2. [æ‹…å½“è€…] â†’ [ã‚¿ã‚¹ã‚¯] ï¼ˆ[æœŸé™]ï¼‰
3. [æ‹…å½“è€…] â†’ [ã‚¿ã‚¹ã‚¯] ï¼ˆ[æœŸé™]ï¼‰

## ğŸ“Š æ ¹æ‹ ï¼ˆ2è¡Œä»¥å†…ï¼‰
â€¢ ãƒ‡ãƒ¼ã‚¿: å®Œäº†[X]/å…¨[Y]ä»¶ã€å¿…è¦æ¶ˆåŒ–[Z]ä»¶/æ—¥ï¼ˆå®Ÿç¸¾[W]ä»¶/æ—¥ï¼‰
â€¢ å•é¡Œ: [ãƒœãƒˆãƒ«ãƒãƒƒã‚¯] + [ãƒªã‚¹ã‚¯] = ç›®æ¨™æœªé”ãƒªã‚¹ã‚¯[%]</pre>
                </div>
            </div>
        </div>

        <!-- Phase 6: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æç”» -->
        <div class="flow-section">
            <div class="phase-header">
                <span class="phase-number">Phase 6</span>
                ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”»åƒç”Ÿæˆ
            </div>

            <div class="step">
                <div class="step-title">
                    <span class="step-icon">10</span>
                    PNGæç”»å‡¦ç†
                </div>
                <div class="function-call">
                    <span class="func-name">draw_png</span>(
                        output_path,
                        data,
                        boards_n,
                        sprints_n,
                        sprint_name,
                        sprint_start,
                        sprint_end,
                        axis_mode,
                        target_done_rate,
                        extras
                    )
                    <div class="input">ğŸ“¥ å…¥åŠ›: 
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>output_path: PNGä¿å­˜å…ˆ</li>
                            <li>data: ã‚µãƒ–ã‚¿ã‚¹ã‚¯é›†è¨ˆãƒ‡ãƒ¼ã‚¿</li>
                            <li>boards_n, sprints_n: è¡¨ç¤ºç”¨ã‚«ã‚¦ãƒ³ãƒˆ</li>
                            <li>sprint_name, sprint_start, sprint_end: ã‚¹ãƒ—ãƒªãƒ³ãƒˆæƒ…å ±</li>
                            <li>axis_mode: "percent" or "count"</li>
                            <li>target_done_rate: ç›®æ¨™é”æˆç‡ï¼ˆæ—¢å®š0.8ï¼‰</li>
                            <li>extras: å…¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»AIè¦ç´„ã‚’å«ã‚€è¾æ›¸</li>
                        </ul>
                    </div>
                    <div class="output">ğŸ“¤ å‡ºåŠ›: PNGç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ1400x980pxï¼‰ã‚’ä¿å­˜</div>
                </div>

                <div class="note">
                    <div class="note-title">ğŸ¨ æç”»å†…å®¹</div>
                    <ul>
                        <li><strong>ãƒ˜ãƒƒãƒ€ãƒ¼å·¦:</strong> ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ/ãƒœãƒ¼ãƒ‰/ã‚¹ãƒ—ãƒªãƒ³ãƒˆ/ã‚¿ã‚¹ã‚¯ã®éšå±¤ãƒãƒ¼</li>
                        <li><strong>ãƒ˜ãƒƒãƒ€ãƒ¼å³:</strong> ãƒãƒ¼ãƒ³ãƒ€ã‚¦ãƒ³ã‚°ãƒ©ãƒ•ï¼ˆäºˆæ¸¬ç·šä»˜ãï¼‰+ ãƒŸãƒ‹ãƒ™ãƒ­ã‚·ãƒ†ã‚£ãƒãƒ£ãƒ¼ãƒˆ + KPI</li>
                        <li><strong>ä¸­å¤®:</strong> ã‚¿ã‚¹ã‚¯å®Œäº†ç‡ã‚µãƒãƒªãƒ¼ãƒãƒ¼ï¼ˆDone/Not Doneï¼‰+ ç›®æ¨™ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ç·š</li>
                        <li><strong>å·¦ã‚«ãƒ©ãƒ :</strong> Velocityãƒãƒ¼ + ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ†å¸ƒ + Time-in-Status ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—</li>
                        <li><strong>å³ã‚«ãƒ©ãƒ :</strong> KPIã‚«ãƒ¼ãƒ‰ï¼ˆ6æšï¼‰+ æ‹…å½“è€…åˆ¥ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰</li>
                        <li><strong>ä¸‹éƒ¨:</strong> ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆTop Nï¼‰</li>
                        <li><strong>ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³:</strong> What/So what/Next actionï¼ˆãƒ‡ãƒ¼ã‚¿å‡ºå…¸æ˜è¨˜ï¼‰</li>
                        <li><strong>ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤:</strong> AIè¦ç´„ãƒ‘ãƒãƒ«ï¼ˆæŠ˜ã‚Šè¿”ã—è¡¨ç¤ºã€é•·æ–‡å¯¾å¿œï¼‰</li>
                        <li><strong>ãƒ•ãƒƒã‚¿ãƒ¼:</strong> ç”Ÿæˆæ—¥æ™‚ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—</li>
                    </ul>
                </div>

                <div class="note" style="background: #f3e5f5; border-left-color: #9c27b0;">
                    <div class="note-title" style="color: #6a1b9a;">ğŸ–¼ï¸ ç”»åƒç”Ÿæˆã®æŠ€è¡“è©³ç´°</div>
                    <ul>
                        <li>Pillow (PIL) ã§ã‚­ãƒ£ãƒ³ãƒã‚¹ä½œæˆãƒ»æç”»</li>
                        <li>ã‚«ãƒ©ãƒ¼ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªé…è‰²</li>
                        <li>æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆå„ªå…ˆãƒ­ãƒ¼ãƒ‰ï¼ˆMeiryo, Yu Gothicç­‰ï¼‰</li>
                        <li>ãƒ†ã‚­ã‚¹ãƒˆå¹…ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°æ©Ÿèƒ½</li>
                        <li>ãƒãƒ¼ãƒ³ãƒ€ã‚¦ãƒ³äºˆæ¸¬ï¼šç·šå½¢å›å¸°ã§å®Œäº†æ—¥æ¨å®š</li>
                        <li>AIè¦ç´„: æŠ˜ã‚Šè¿”ã—è¡¨ç¤ºã€æœ€å¤§è¡Œæ•°åˆ¶é™</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Phase 7: è¿½åŠ å‡ºåŠ› -->
        <div class="flow-section">
            <div class="phase-header">
                <span class="phase-number">Phase 7</span>
                è¿½åŠ ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ã¨ãƒ­ã‚°
            </div>

            <div class="step">
                <div class="step-title">
                    <span class="step-icon">11</span>
                    Markdownãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
                </div>
                <div class="data-flow">
                    <div class="data-label">ğŸ“„ sprint_overview_report.md</div>
                    <ul>
                        <li>è¦ç´„ï¼ˆWhat/So what/Next actionï¼‰</li>
                        <li>AIè¦ç´„å…¨æ–‡ï¼ˆGeminiç”Ÿæˆï¼‰</li>
                        <li>ãƒªã‚¹ã‚¯ä¸€è¦§ï¼ˆæœŸé™è¶…éãƒ»æ¥è¿‘ãƒ»é«˜å„ªå…ˆåº¦æœªç€æ‰‹ã®èª²é¡Œã‚­ãƒ¼ï¼‰</li>
                        <li>ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆTop Nèª²é¡Œã®è©³ç´°ï¼‰</li>
                        <li>çŸ­æœŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆ</li>
                    </ul>
                </div>
            </div>

            <div class="arrow">â¬‡ï¸</div>

            <div class="step">
                <div class="step-title">
                    <span class="step-icon">12</span>
                    æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›
                </div>
                <div class="parallel-group">
                    <div class="parallel-item">
                        <strong>sprint_overview_tasks.json</strong>
                        <div style="margin-top: 8px; font-size: 0.9em;">
                            ã‚¹ãƒ—ãƒªãƒ³ãƒˆæƒ…å ± + parents/subtasks + totals
                        </div>
                    </div>
                    <div class="parallel-item">
                        <strong>sprint_overview_data.json</strong>
                        <div style="margin-top: 8px; font-size: 0.9em;">
                            ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¦ç´„ï¼ˆSlacké€£æºç”¨ï¼‰
                        </div>
                    </div>
                </div>
            </div>

            <div class="arrow">â¬‡ï¸</div>

            <div class="step">
                <div class="step-title">
                    <span class="step-icon">13</span>
                    ãƒ­ã‚°å‡ºåŠ›ã¨ãƒ‘ã‚¹è¡¨ç¤º
                </div>
                <div class="note">
                    <div class="note-title">ğŸ“‹ ãƒ­ã‚°å†…å®¹ï¼ˆDASHBOARD_LOG=1æ™‚ï¼‰</div>
                    <ul>
                        <li>å„ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®ã‚µãƒãƒªãƒ¼ï¼ˆä»¶æ•°ã€æ—¥æ•°ã€å¹³å‡å€¤ç­‰ï¼‰</li>
                        <li>Geminiå‘¼ã³å‡ºã—çµæœï¼ˆæˆåŠŸ/å¤±æ•—ã€APIã‚­ãƒ¼ãƒã‚¹ã‚¯è¡¨ç¤ºï¼‰</li>
                        <li>ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ä»¶æ•°ã¨ã‚­ãƒ¼ãƒªã‚¹ãƒˆ</li>
                    </ul>
                </div>
                <div class="function-call" style="margin-top: 10px;">
                    print(<span style="color: #00695c;">out_path</span>)  # æœ€çµ‚çš„ã«PNGãƒ‘ã‚¹ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›
                </div>
                <div class="output" style="margin-left: 0; margin-top: 10px;">
                    ğŸ“¤ æˆ»ã‚Šå€¤: 0ï¼ˆæ­£å¸¸çµ‚äº†ï¼‰
                </div>
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <div class="legend-title">ğŸ“š å‡¡ä¾‹</div>
            <div class="legend-item">
                <span class="legend-box" style="background: #667eea;"></span>
                ãƒ¡ã‚¤ãƒ³ãƒ•ã‚§ãƒ¼ã‚º
            </div>
            <div class="legend-item">
                <span class="legend-box" style="background: #e3f2fd; border: 2px solid #2196f3;"></span>
                ä¸¦åˆ—å‡¦ç†
            </div>
            <div class="legend-item">
                <span class="legend-box" style="background: #fff3e0; border-left: 4px solid #ff9800;"></span>
                æ³¨è¨˜ãƒ»è©³ç´°
            </div>
            <div class="legend-item">
                <span class="legend-box" style="background: #e8f5e9; border: 2px dashed #4caf50;"></span>
                ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
            </div>
            <div class="legend-item">
                <span class="legend-box" style="background: white; border: 2px solid #e8eaf6;"></span>
                é–¢æ•°å‘¼ã³å‡ºã—
            </div>
        </div>

        <div class="note" style="margin-top: 40px; background: #e1f5fe; border-left-color: #0288d1;">
            <div class="note-title" style="color: #01579b;">ğŸ’¡ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥</div>
            <ul>
                <li>Phase 4ä»¥é™ã®å„ã‚¯ã‚¨ãƒªã¯ç‹¬ç«‹ã—ãŸtry-exceptã§ä¿è­·ã•ã‚Œã€å¤±æ•—ã—ã¦ã‚‚Noneã‚’æ ¼ç´ã—ã¦å‡¦ç†ç¶™ç¶š</li>
                <li>Geminiå‘¼ã³å‡ºã—ã¯ç’°å¢ƒå¤‰æ•°ï¼ˆGEMINI_DISABLEï¼‰ã§ç„¡åŠ¹åŒ–å¯èƒ½</li>
                <li>APIã‚­ãƒ¼ãŒä¸æ­£ãªå ´åˆã¯ã‚µãƒ‹ã‚¿ã‚¤ã‚ºå¾Œã«å†è©¦è¡Œã€æœ€çµ‚çš„ã«ç©ºè¦ç´„ã§ç¶™ç¶š</li>
                <li>ç”»åƒæç”»ã§ä¾‹å¤–ãŒèµ·ãã¦ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ã¾ã§åˆ°é”ã—ã€éƒ¨åˆ†çš„ãªçµæœã‚’ä¿å­˜</li>
            </ul>
        </div>

        <div style="text-align: center; margin-top: 40px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
            <p style="color: #7f8c8d; font-size: 0.9em;">
                ç”Ÿæˆæ—¥æ™‚: 2025å¹´10æœˆ2æ—¥<br>
                å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: prototype/local_cli/main.py (2655è¡Œ)<br>
                ãƒ•ãƒ­ãƒ¼å›³ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0
            </p>
        </div>
    </div>
</body>
</html>
